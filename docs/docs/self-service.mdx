---
id: self-service
title: Self-Service Flows
sidebar_label: Concepts and Overview
---

import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

ORY Kratos implements flows that users perform themselves as opposed to
administrative intervention. Facebook and Google both provide self-service
registration and profile management features as you are able to make changes to
your profile and sign up yourself.

Most believe that user management systems are easy to implement because picking
the right password hashing algorithm and sending an account verification code is
a solvable challenge. The real complexity however hides in the details and
attack vectors of self-service flows. Most data leaks happen because someone is
able to exploit

- registration: with attack vectors such as account enumeration (), ...;
- login: phishing, account enumeration, leaked password databases, brute-force,
  ...;
- user settings: account enumeration, account takeover, ...;
- account recovery: social engineering attacks, account takeover, spoofing, and
  so on.

There are also many other areas you need to think about, such as:

- Mobile, Smart TV, ... authentication
- Linking and unlinking social profiles (e.g. "Sign in with Google" or "Connect
  with Google") to existing accounts

ORY Kratos applies best practices established by experts (National Institute of
Sciences NIST, Internet Engineering Task Force IETF, Microsoft Research, Google
Research, Troy Hunt, ...) and implements the following flows:

- [Login and Registration](self-service/flows/user-login-user-registration)
- [Logout](self-service/flows/user-logout)
- [User Settings](self-service/flows/user-settings)
- [Account Recovery](self-service/flows/account-recovery)
- [Address Verification](self-service/flows/verify-email-account-activation)
- [User-Facing Error](self-service/flows/user-facing-errors)
- [2FA / MFA](self-service/flows/2fa-mfa-multi-factor-authentication)

Some flows break down into "flow methods" which implement some of the flow's
business logic:

- The `password` strategy implement the
  [login and registration with "email or/and username and password" method](self-service/flows/user-login-user-registration/username-email-password),
  and
  ["change your password" user settings method](self-service/flows/user-settings/change-password).
- The `oidc` (OpenID Connect, OAuth2, Social Sign In) strategy implements
  ["Sign in with ..." login and registration method](self-service/flows/user-login-user-registration/openid-connect-social-sign-in-oauth2)
  and
  ["un/link another social account" user settings method](self-service/flows/user-settings/link-unlink-openid-connect-oauth2).
- The `profile` strategy implements the
  ["update your profile", "change your first/last name, ..." user settings method)](self-service/flows/user-settings/user-profile-management).
- The `link` strategy implements the
  ["click this link to reset your password" account recovery method](self-service/flows/user-settings/user-profile-management).

Some flows additionally implement the ability
[to run hooks](self-service/hooks/index) which allow users to be immediately
signed in after registration, notify another system on successful registration
(e.g. Mailchimp), and so on.

## Performing Login, Registration, Settings, ... Flows

There are two flow types supported in ORY Kratos:

- Flows where the user sits in front of the Browser (e.g. website, single page
  app, ...)
- Flows where API interaction is required (e.g. mobile app, Smart TV, ...)

All Self-Service Flows
([User Login](self-service/flows/user-login-user-registration),
[User Registration](self-service/flows/user-login-user-registration),
[Profile Management](self-service/flows/user-settings),
[Account Recovery](self-service/flows/account-recovery),
[Email or Phone verification](self-service/flows/verify-email-account-activation))
support these two flow types and use the same data models but do use different API endpoints.

### Browser Flows

First, the Browser opens the flow's initialization endpoint (e.g.`/self-service/login/browser`,
`/self-service/registration/browser`, ...):

<Tabs
  defaultValue="curl"
  values={[
    {label: 'CURL', value: 'curl'},
    {label: 'HTML', value: 'html'},
    {label: 'Javascript', value: 'js'},
    {label: 'ExpressJS', value: 'nodejs'},
  ]}>
<TabItem value="curl">

This CURL request emulates a browser request:

```
$ curl -x GET
 -H "Accept: text/html" http://127.0.0.1:4433/self-service/login/browser
```

</TabItem>
<TabItem value="html">

```html
<a href="http://127.0.0.1:4433/self-service/login/browser">Sign in</a>
```

</TabItem>
<TabItem value="js">

```html
<script>
const initLogin = () => {
  window.location.href = 'http://127.0.0.1:4433/self-service/login/browser'
}
</script>

<a onClick="initLogin">Sign in</a>
```

</TabItem>
<TabItem value="nodejs">

```js
express.get('/login', function (req, res) {
  res.redirect(302, 'http://127.0.0.1:4433/')
})

```

</TabItem>
</Tabs>

The initialization endpoint creates a flow object and stores it in the
database. The flow object has an ID and contains additional information about
the flow such as the login methods (e.g. "username/password" and "Sign in
with Google") and their form data.

Once stored, the Browser is HTTP 302 redirected to the flow's configured UI URL (e.g.
`selfservice.flows.login.ui_url`), appending the flow ID as the `flow` URL
Query Parameter. The initialization endpoint (e.g. `http://127.0.0.1:4433/self-service/login/browser`)
responsds with:

```
GET http(s)://public.my-kratos/self-service/login/browser

HTTP 302 Found
Location:
```

The Browser opens the URL which renders the HTML form that, for example, shows the "username and password" field,
the "Update your email address" field, or other flow forms. This HTML form is rendered be the [Self-Service UI](concepts/ui-user-interface#self-service-user-interface-ssui)
which you fully control.

The endpoint responsible for the UI URL uses the `flow` URL Query Parameter
(e.g. `http://my-app/auth/login?flow=abcde`) to call the flow information
endpoint (e.g. `/self-service/login/flows?id=abcde`) and fetch the flow
data - so for example the login form and any validation errors. This endpoint
is available at both ORY Kratos's Public and Admin Endpoints. For example,
the Self-Service UI responsible for rendering the Login HTML Form would
make a request along the lines of:

```
# The endpoint uses ORY Kratos' REST API to fetch information about the request
$ curl -x GET \
 -H "Accept: application/json" \
 http://127.0.0.1:4433/self-service/login/browser?request=...
```

The result includes login methods, their fields, and additional information about the flow:

```

```

For more details, check out the individual flow documentation.

The user completes the flow by submitting the form. The form action always points to ORY Kratos directly.
The business logic for the flow method will then validate the form payload and return to the UI URL on
validation errors

and include the validation errors.

If a system error (e.g. broken configuration file) occurs, the browser is redirected to the
[Error UI](self-service/flows/user-facing-errors).

If the form payload is valid, the flow completes with a success. The result here depends on the flow itself -
the login flow for example redirects the user to a specified redirect URL and sets a session cookie. The
registration flow also redirects to a specified redirect URL but only creates the user in the database and might
issue a session cookie if configured to do so.

### API Flows

The client (e.g. mobile application) makes a request to the flow's initialization endpoint


First, the Browser opens the flow's initialization endpoint (e.g.`/self-service/login/browser`,
`/self-service/registration/browser`, ...):

<Tabs
  defaultValue="curl"
  values={[
    {label: 'CURL', value: 'curl'},
    {label: 'NodeJS', value: 'nodejs'},
  ]}>
<TabItem value="curl">
```
$ curl -x GET \
  -H "Accept: application/json" \
  http://127.0.0.1:4433/self-service/login/api
```

</TabItem>
<TabItem value="nodejs">

```js
const fetch = require('node-fetch')

fetch.get('http://127.0.0.1:4433/self-service/login/api', {
  headers: { Accept: 'text/html' }
})
  .then(res=>res.json())
  .then((flow) => console.log(flow))
```

</TabItem>
</Tabs>

2. The initialization endpoint creates a flow object and stores it in the
   database. The flow object has an ID and contains additional information about
   the flow such as the login methods (e.g. "username/password" and "Sign in
   with Google") and their form data. Once stored, the flow data is directly
   returned as `application/json` without redirects.

3. The client uses the flow data to render the UI - so for example the login
   form and any validation errors.

4. The client completes the flow by e.g. making another `application/json`
   request.

5. If needed, the client can re-request the flow information (e.g. because the
   form completed with validation errors) by calling the flow information
   endpoint (e.g. `/self-service/login/flows?id=abcde`). This endpoint is
   available at both ORY Kratos's Public and Admin Endpoints.
