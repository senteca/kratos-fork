---
id: user-profile-management
title: User Profile Management
---

:::tip Before you start

Please read through the [User Settings Documentation](../user-settings.mdx)
first.

:::

The `profile` method allows a user to change their identity traits ("profile").

The updated traits must be valid against the Identity JSON Schema defined for
its [Identity Traits](../../../concepts/identity-user-model). If one or more
fields do not validate (e.g. "Not an email"), the profile will not be updated.

ORY Kratos will prompt the user to re-authenticate if a privileged trait (e.g.
email used to log in) is changed, similar to the
[GitHub sudo mode](https://help.github.com/en/github/authenticating-to-github/sudo-mode).

You can configure how long a session is "privileged" by setting:

```yaml title="path/to/kratos/config.yml"
selfservice:
  flows:
    settings:
      # Sessions older than a minute requires the user to sign in again before
      # the password is changed.
      privileged_session_max_age: 1m
```

This method does not implement any other flow.

## Create A User

Before we start with the examples below, let's create a user using the API Flows. This will yield a session token
which then use to perform the profile update flows:

```shell script
username=foo-user@ory.sh
password=sBdHzGp9hAx2Hf2m

actionUrl=$(curl -s -H "Accept: application/json" \
  'http://127.0.0.1:4433/self-service/registration/api' | jq -r '.methods.password.config.action'))

session=$(curl -s  -X POST -H "Accept: application/json" -H "Content-Type: application/json" \
  --data '{ "traits.email": "'$username'", "password": "'$password'" }' \
  "$actionUrl"

session_token=$(echo $session | jq -r '.session_token')
echo $session_token
```

## Browser Clients

Redirecting the browser to the
[Self-Service Settings Endpoint](../user-settings.mdx#user-settings-process-sequence)
initiates the flow:

```shell script
$ curl -s -D - -X GET -H "Authorization: bearer $session_token" \
  --cookie cookie.txt --cookie-jar cookie.txt \
  http://127.0.0.1:4433/self-service/settings/browser

HTTP/1.1 302 Found
Cache-Control: 0
Content-Type: text/html; charset=utf-8
Location: http://127.0.0.1:4455/settings?flow=c3625ca1-7e15-4e4c-82fb-f25e0d48ad48
Vary: Cookie
Date: Thu, 03 Sep 2020 16:11:51 GMT
Content-Length: 95

<a href="http://127.0.0.1:4455/settings?flow=c3625ca1-7e15-4e4c-82fb-f25e0d48ad48">Found</a>.
```

The Settings Request Response Payload always includes a `profile` method:

```shell script
$ curl -s -H "Authorization: bearer $session_token" -H "Accept: application/json" \
  'http://127.0.0.1:4433/self-service/settings/flows?id=c3625ca1-7e15-4e4c-82fb-f25e0d48ad48' | jq

{
  "id": "9c6473d4-9ffd-44cd-9794-adb82cbe4009",
  "expires_at": "2020-05-02T16:06:08.131598Z",
  "issued_at": "2020-05-02T15:06:08.131599Z",
  "request_url": "http://127.0.0.1:4433/self-service/browser/flows/settings",
  "active": "profile",
  "methods": {
    "profile": {
      "method": "profile",
      "config": {
        "action": "http://127.0.0.1:4455/.ory/kratos/public/self-service/browser/flows/settings/strategies/profile?request=9c6473d4-9ffd-44cd-9794-adb82cbe4009",
        "method": "POST",
        "fields": [
          {
            "name": "csrf_token",
            "type": "hidden",
            "required": true,
            "value": "HfvOBEv/D6PbXc89hsoEd0UMfZXKsvQXJzmXZJnq6BsBAwm8zbMKQF4LLZwRL67hPDlViB/qcJtu6yf+klIBeg=="
          },
          {
            "name": "traits.email",
            "type": "text",
            "required": false,
            "value": "xx0bdh@l7zkk8"
          },
          {
            "name": "traits.website",
            "type": "text",
            "required": false,
            "value": "http://github.com/aeneasr"
          }
        ]
      }
    }
  },
  "identity": {
    "id": "93548b1b-c8dc-4d3e-b19f-cfc6d812a8d0",
    "schema_id": "default",
    "traits": {
      "email": "xx0bdh@l7zkk8",
      "website": "http://github.com/aeneasr"
    }
  },
  "update_successful": false
}
```

If the form validation fails, an error will be included:

```json5 title="$ curl http://<kratos-admin>/self-service/browser/flows/requests/settings?request=9c6473d4-9ffd-44cd-9794-adb82cbe4009"
{
  id: '9c6473d4-9ffd-44cd-9794-adb82cbe4009',
  // expires_at, ...
  active: 'profile', // <- this is now set!
  methods: {
    profile: {
      method: 'profile',
      config: {
        // action, ...
        fields: [
          // csrf_token, ...
          {
            name: 'traits.website',
            type: 'text',
            required: false,
            value: 'http://s',
            messages: [
              {
                /* id, type */
                text: 'length must be >= 10, but got 8'
              }
            ]
          }
        ]
      }
    }
  },
  // identity, ...
  update_successful: false
}
```

A successful flow will be marked with:

```json5 title="$ curl http://<kratos-admin>/self-service/browser/flows/requests/settings?request=9c6473d4-9ffd-44cd-9794-adb82cbe4009"
{
  id: '9c6473d4-9ffd-44cd-9794-adb82cbe4009',
  // expires_at, active, methods, ...
  update_successful: true
}
```

## API Clients

API-based login and registration using this method will be addressed in a future
release of ORY Kratos.

## Security

### Account Enumeration Defenses (work in progress)

> This feature is a work in progress and is tracked as
> [kratos#133](https://github.com/ory/kratos/issues/133).

### Account Takeover Defenses

The Settings flow implements account takeover defenses as it is not possible to
change the password without knowing the existing password. A good example of
this flow is the
[GitHub sudo mode](https://help.github.com/en/github/authenticating-to-github/sudo-mode).
