---
id: user-settings
title: User Settings
sidebar_label: Overview
---

import Mermaid from '@theme/Mermaid'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'
import SelfServiceBrowserFlow from '@theme/SelfServiceBrowserFlow'
import SelfServiceApiFlow from '@theme/SelfServiceApiFlow'
import CodeFromRemote from '@theme/CodeFromRemote'

ORY Kratos allows users to update their own settings and profile information
using two principal flows:

- Flows where the user sits in front of the Browser (e.g. website, single page
  app, ...)
- Flows where API interaction is required (e.g. mobile app, Smart TV, ...)

The Settings Flow described here is implemented by the
[profile](user-settings/user-profile-management.mdx),
[password](user-login-user-registration/username-email-password.mdx), and
[oidc](user-login-user-registration/openid-connect-social-sign-in-oauth2.mdx)
methods.

:::note

Please read the [Self-Service Flows](../../self-service) overview before
continuing with this document.

:::

The Settings Flow is composed of several high-level steps
summarized in this state diagram:

<Mermaid
  chart={`
stateDiagram
  s1: Flow is initialized
  s2: Execute Before Settings Hook(s)
  s3: User Interface renders Settings Flow Forms
  s4: Check if privileged fields were updated
  s8: Ask user to sign in again/confirm with password
  s7: Execute After Settings Hook(s)
  s5: Update Settings Flow with error context(s)
  s6: Settings update successful
	[*] --> s1 : User clicks "Update my profile"
  s1 --> s2
  s2 --> Error : A hook fails
  s2 --> s3
  s3 --> s4 : User provides valid credentials/registration data
  s3 --> s5 : User provides invalid credentials/registration data
  s5 --> s3
  s7 --> Error : A hook fails
  s4 --> s8: yes
  s4 -->s7: no
  s8--> s7: Authentication successful
  s7 --> s6
  s6 --> [*]
  Error --> [*]
`}
/>

## Self-Service User Settings for Browser Applications

Each Settings Method works a bit different but they all boil down to the same
abstract sequence. This sequence was already established in the
[Self-Service Browser Flow Documentation](../../self-service#browser-flows).

<SelfServiceBrowserFlow
  flows={['settings']}
  success="Update Identity"
  interactions={['"Save Profile Changes"']}
/>

The _Flow UI_ (**your application!**) is responsible for rendering the actual
Settings HTML Forms. You can of course implement one app for
rendering all the Settings, Login, Registration, ... screens, and another app (think
"Service Oriented Architecture", "Micro-Services" or "Service Mesh") is
responsible for rendering your Dashboards, Management Screens, and so on.

### Initialization and Redirect to UI

The Browser
[calls the initialization endpoint](../../self-service#initialization-and-redirect-to-ui)
for settings flows (`/self-service/settings/browser`) and is redirected to the UI configured at

```yaml title="path/to/config/kratos.yml"
selfservice:
  flows:
    settings:
      ui_url: http://...
```

### Settings Form Rendering

The Settings User Interface is a route (page / site) in your application that
renders the user settings / profile management User Interface / HTML Form:

```html
<!-- Profile management -->
<form action="..." method="POST">
  <input type="hidden" name="csrf_token" value="cdef..." />
  <input type="string" name="traits.first_name" />
  <input type="string" name="traits.last_name" />
  <input type="string" name="traits.address" />
  <input type="..." name="..." />
  <input type="submit" />
</form>

<!-- Password management -->
<form action="..." method="POST">
  <input type="hidden" name="csrf_token" value="cdef..." />
  <input
    type="password"
    name="password"
    placeholder="Enter your new password here"
  />
</form>

<!-- Social Sign in  management -->
<form action="..." method="POST">
  <input type="hidden" name="csrf_token" value="cdef..." />
  <!-- ... -->
</form>
```

In stark contrast to other Identity Systems, ORY Kratos does not render this
HTML. Instead, you need to implement the HTML code in your application (e.g.
NodeJS + ExpressJS, Java, PHP, ReactJS, ...), which gives you extreme
flexibility and customizability in your user interface flows and designs.

### User Settings Request State

The Settings Request contains a state with two possible values:

- `show_form`: No user data has been collected, or it is invalid, and thus the
  form should be shown.
- `successful`: Indicates that the settings request has been updated
  successfully with the provided data. The state will stay `successful` when
  repeatedly checking. If the form is still displayed and the user adds more
  data, the state will revert back to `show_form` on validation errors.

<Mermaid
  chart={`stateDiagram-v2
[*] --> show_form
show_form --> show_form: Validation fails
show_form --> success: Identity was updated
success --> show_form: Validation fails
success --> [*]
`}
/>

### Updating Privileged Fields

When certain traits or fields such as the password, the recovery email, the login identifier, or other
privileged traits are updated, the user is required to have a session which is no older than
the lifetime specified in:

```yaml title="path/to/kratos/config.yml"
selfservice:
  flows:
    settings:
      # Sessions older than a minute requires the user to sign in again before
      # the password is changed.
      privileged_session_max_age: 1m
```

When this happens, the browser is redirected to the login endpoint, and once the login was completed
successfully, the data is updated and the user returns to the settings page or the configured
redirect URL.

### Code Examples

A functioning example of the code and approach used here can
be found on
[github.com/ory/kratos-selfservice-ui-node](https://github.com/ory/kratos-selfservice-ui-node).

<Tabs
  defaultValue="express"
  values={[
    {label: 'ExpressJS & Handlebars', value: 'express'},
    {label: 'ReactJS', value: 'react'},
  ]}>
<TabItem value="express">

<CodeFromRemote
  link="https://github.com/ory/kratos-selfservice-ui-node/blob/master/src/routes/settings.ts"
  src="https://raw.githubusercontent.com/ory/kratos-selfservice-ui-node/master/src/routes/settings.ts"
/>

The views can be rather simple, as ORY Kratos provides you with all the
information you need for rendering the forms.

The following examples use Handlebars and a generic form generator to render the
Flow:

<Tabs
  defaultValue="settings"
  values={[
    {label: 'Settings View', value: 'settings'},
    {label: 'Generic Form View', value: 'generic-form'},
  ]}>

<TabItem value="settings">

<CodeFromRemote
  link="https://github.com/ory/kratos-selfservice-ui-node/blob/master/views/settings.hbs"
  src="https://raw.githubusercontent.com/ory/kratos-selfservice-ui-node/master/views/settings.hbs"
/>

</TabItem>

<TabItem value="generic-form">

<CodeFromRemote
  link="https://github.com/ory/kratos-selfservice-ui-node/blob/master/views/partials/form.hbs"
  src="https://raw.githubusercontent.com/ory/kratos-selfservice-ui-node/master/views/partials/form.hbs"
/>

</TabItem>
</Tabs>

The rest of the form partials can be found
[here](https://github.com/ory/kratos-selfservice-ui-node/tree/master/views/partials).

</TabItem>
<TabItem value="react">

A react example is currently in the making.

</TabItem>
</Tabs>

For details on payloads consult the individual Self-Service Settings Methods:

- [Username and Password Method](user-login-user-registration/username-email-password.mdx)
- [Social Sign In Method](user-login-user-registration/openid-connect-social-sign-in-oauth2.mdx)
- [User Profile Method](user-settings/user-profile-management.mdx)

## Self-Service User Settings for API Clients

<SelfServiceApiFlow
  flows={['settings']}
  success="Update Identity"
  interactions={['"Save Profile Changes"']}
/>

### Initialization

The client
[calls the API-flow initialization endpoint](../../self-service#initialization)
for settings (`/self-service/settings/api`). The response is a JSON payload containing
information about the flow.

### Settings Form Rendering

The form is rendered as established in the
[API flow form rendering documentation](../../self-service#form-rendering-1).

### Form Submission

To submit the form, follow
[API flow form submission and payload validation](../../self-service#form-submission-and-payload-validation-1).

### Code Examples

<Tabs
  defaultValue="login-rn"
  values={[
    {label: 'Settings React Native', value: 'login-rn'},
  ]}>
<TabItem value="login-rn">

Code samples will follow soon

</TabItem>

</Tabs>

## Hooks

ORY Kratos allows you to configure hooks that run before and after a profile
update was successful. For more information about hooks please read the
[Hook Documentation](../hooks).
